<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PedeMais1 - Cardápio (Teste)</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h1>Cardápio - Teste</h1>
        <div id="status" class="alert alert-info">Carregando...</div>
        <div id="produtos" class="row"></div>
        <button id="addTestBtn" class="btn btn-primary mb-3" style="display: none;">Adicionar Produtos de Teste</button>
    </div>

    <!-- Supabase JavaScript Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const SUPABASE_URL = 'https://kecthdahzuzjoilfntiq.supabase.co'
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtlY3RoZGFoenV6am9pbGZudGlxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDYzODE5NjEsImV4cCI6MjA2MTk1Nzk2MX0.3jFEYqQFr00hE4jmNtE7iZjXqbei5MgpVD_IRwiGKkw'

        const statusDiv = document.getElementById('status')
        const produtosDiv = document.getElementById('produtos')
        const addTestBtn = document.getElementById('addTestBtn')

        let supabaseClient = null

        async function initSupabase() {
            try {
                if (typeof window.supabase === 'undefined') {
                    statusDiv.innerHTML = '<div class="alert alert-danger">Supabase não está disponível</div>'
                    return false
                }

                supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
                statusDiv.innerHTML = '<div class="alert alert-success">Supabase inicializado com sucesso!</div>'
                return true
            } catch (error) {
                statusDiv.innerHTML = `<div class="alert alert-danger">Erro ao inicializar Supabase: ${error.message}</div>`
                return false
            }
        }

        async function carregarProdutos() {
            try {
                statusDiv.innerHTML = '<div class="alert alert-info">Carregando produtos...</div>'

                const { data, error } = await supabaseClient
                    .from('produtos')
                    .select('*')
                    .order('categoria, nome')

                if (error) {
                    throw error
                }

                statusDiv.innerHTML = `<div class="alert alert-success">Encontrados ${data.length} produtos</div>`
                
                if (data.length === 0) {
                    addTestBtn.style.display = 'block'
                    produtosDiv.innerHTML = '<div class="col-12"><p class="text-muted">Nenhum produto encontrado. Clique no botão acima para adicionar produtos de teste.</p></div>'
                } else {
                    renderizarProdutos(data)
                }

            } catch (error) {
                statusDiv.innerHTML = `<div class="alert alert-danger">Erro ao carregar produtos: ${error.message}</div>`
                console.error('Erro:', error)
            }
        }

        function renderizarProdutos(produtos) {
            produtosDiv.innerHTML = ''

            produtos.forEach(produto => {
                const produtoHTML = `
                    <div class="col-md-4 mb-3">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">${produto.nome}</h5>
                                <p class="card-text">${produto.descricao || 'Sem descrição'}</p>
                                <p class="card-text"><strong>Categoria:</strong> ${produto.categoria}</p>
                                <p class="card-text text-success"><strong>R$ ${produto.preco.toFixed(2)}</strong></p>
                            </div>
                        </div>
                    </div>
                `
                produtosDiv.innerHTML += produtoHTML
            })
        }

        async function adicionarProdutosTeste() {
            try {
                const testProducts = [
                    {
                        nome: 'Hambúrguer Clássico',
                        categoria: 'lanches',
                        preco: 25.90,
                        descricao: 'Hambúrguer artesanal com carne, queijo, alface e tomate'
                    },
                    {
                        nome: 'Coca-Cola 350ml',
                        categoria: 'bebidas',
                        preco: 5.50,
                        descricao: 'Refrigerante gelado'
                    },
                    {
                        nome: 'Brigadeiro',
                        categoria: 'sobremesas',
                        preco: 3.50,
                        descricao: 'Doce de chocolate tradicional'
                    },
                    {
                        nome: 'Pizza Margherita',
                        categoria: 'lanches',
                        preco: 35.00,
                        descricao: 'Pizza com molho de tomate, mussarela e manjericão'
                    },
                    {
                        nome: 'Suco de Laranja',
                        categoria: 'bebidas',
                        preco: 8.00,
                        descricao: 'Suco natural de laranja'
                    }
                ]

                const { data, error } = await supabaseClient
                    .from('produtos')
                    .insert(testProducts)

                if (error) {
                    throw error
                }

                statusDiv.innerHTML = '<div class="alert alert-success">Produtos de teste adicionados! Recarregando...</div>'
                setTimeout(() => {
                    carregarProdutos()
                    addTestBtn.style.display = 'none'
                }, 1000)

            } catch (error) {
                statusDiv.innerHTML = `<div class="alert alert-danger">Erro ao adicionar produtos: ${error.message}</div>`
                console.error('Erro:', error)
            }
        }

        // Event listeners
        addTestBtn.addEventListener('click', adicionarProdutosTeste)

        // Inicializar quando a página carregar
        window.addEventListener('load', async () => {
            const success = await initSupabase()
            if (success) {
                await carregarProdutos()
            }
        })
    </script>
</body>
</html> 